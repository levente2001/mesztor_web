<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {font-family: Arial, Helvetica, sans-serif; height: 70vh; display: flex; align-items: center; justify-content: center;}
form {border: 3px solid #f1f1f1; max-width: 1000px; margin: auto; border-radius: 15px; background: #fff;}

html {
  background-color: #eee;
}

input[type=email], input[type=password] {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  box-sizing: border-box;
  border-radius: 8px;
}

button {
  background-color: #222;
  color: white;
  border-radius: 10px;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  font-weight: bold;
  cursor: pointer;
  width: 100%;
}

button:hover {
  opacity: 0.8;
}

.cancelbtn {
  width: auto;
  padding: 10px 28px;
  font-weight: bold;
  background-color: #04AA6D;
}

.container {
  padding: 0px 16px;
  border-radius: 15px;
}
.containerbottom {
  padding: 10px 16px;
  margin-top: 40px;
  border-radius: 15px;
}

span.psw {
  float: left;
  padding-top: 10px;
  color: #222;
  margin-bottom: 10px;
}


span.psw a {
  color: #061ac8;
}

/* Change styles for span and cancel button on extra small screens */
@media screen and (max-width: 300px) {
  span.psw {
     display: block;
     float: none;
  }
  .cancelbtn {
     width: 100%;
  }
}
</style>
</head>
<body>


<form id="loginForm" method="post">


  <div class="container">

    <h1 style="margin-bottom: 50px;"><span style="color: #D96C06;">Mesztor</span> admin</h1>
    <label for="uname"><b>Felhasználónév</b></label>
    <input type="email" id="email" placeholder="Email címed" name="uname" required>

    <label for="psw"><b>Jelszó</b></label>
    <input type="password" id="password" placeholder="Jelszó" name="psw" required>

    <div style="display: grid; grid-template-rows: 1fr 1fr; margin-top: 20px;">
      <div>
        <button type="submit">Bejelentkezés →</button>
      </div>
      <div id="authMsg" style="margin-top:10px;font-size:14px;"></div>
      <div>
        <span class="psw">Elfelejtettem a <a href="#" id="resetLink">jelszavam</a></span>
      </div>
      
    

    </div>
    
  </div>

</form>

<script type="module">
  import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, setPersistence, browserLocalPersistence, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAZUGCJkn9L4xH_M8L0fZYTUresZ9qYPqo",
    authDomain: "flymeto-696d0.firebaseapp.com",
    databaseURL: "https://flymeto-696d0-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "flymeto-696d0",
    storageBucket: "flymeto-696d0.firebasestorage.app",
    messagingSenderId: "651204605205",
    appId: "1:651204605205:web:d5dfbf3698be7ac6ee251c",
    measurementId: "G-4L7YN2X9YL"
  };

  const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // "Emlékezzen rám" (alapból local)
  try { await setPersistence(auth, browserLocalPersistence); } catch {}

  const form = document.getElementById("loginForm");
  const emailEl = document.getElementById("email");
  const passEl  = document.getElementById("password");
  const msgEl   = document.getElementById("authMsg");
  const resetLink = document.getElementById("resetLink");

  const params = new URLSearchParams(location.search);
  const next = params.get("next") || "./index.html";

  function setMsg(text, ok=false){
    if(!msgEl) return;
    msgEl.textContent = text || "";
    msgEl.style.color = ok ? "#0f7a2a" : "#b00020";
  }

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    setMsg("");

    const email = (emailEl?.value || "").trim();
    const password = passEl?.value || "";

    if(!email || !password){
      setMsg("Add meg az email címet és a jelszót.");
      return;
    }

    try{
      await signInWithEmailAndPassword(auth, email, password);
      setMsg("Sikeres bejelentkezés ✅", true);
      location.replace(next);
    }catch(err){
      console.warn("[login] hiba:", err);
      const code = err?.code || "";
      if(code === "auth/unauthorized-domain"){
        setMsg("Hibás domain beállítás (auth/unauthorized-domain). Add hozzá a Netlify domaint a Firebase Console → Authentication → Settings → Authorized domains listához.");
      }else if(code === "auth/invalid-login-credentials" || code === "auth/wrong-password" || code === "auth/user-not-found"){
        setMsg("Hibás email vagy jelszó.");
      }else{
        setMsg("Nem sikerült bejelentkezni. (" + (code || "ismeretlen hiba") + ")");
      }
    }
  });

  resetLink?.addEventListener("click", async (e) => {
    e.preventDefault();
    setMsg("");
    const email = (emailEl?.value || "").trim();
    if(!email){
      setMsg("Írd be az email címedet, és utána kattints a jelszó-visszaállításhoz.");
      return;
    }
    try{
      await sendPasswordResetEmail(auth, email);
      setMsg("Jelszó-visszaállító email elküldve ✅", true);
    }catch(err){
      console.warn("[reset] hiba:", err);
      setMsg("Nem sikerült jelszó-visszaállítót küldeni. (" + (err?.code || "ismeretlen hiba") + ")");
    }
  });
</script>
</body>
</html>