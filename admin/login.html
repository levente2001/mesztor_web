<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {font-family: Arial, Helvetica, sans-serif; height: 70vh; display: flex; align-items: center; justify-content: center;}
form {border: 3px solid #f1f1f1; max-width: 1000px; margin: auto; border-radius: 15px; background: #fff;}

html {
  background-color: #eee;
}

input[type=email], input[type=password] {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  box-sizing: border-box;
  border-radius: 8px;
}

button {
  background-color: #222;
  color: white;
  border-radius: 10px;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  font-weight: bold;
  cursor: pointer;
  width: 100%;
}

button:hover {
  opacity: 0.8;
}

.cancelbtn {
  width: auto;
  padding: 10px 28px;
  font-weight: bold;
  background-color: #04AA6D;
}

.container {
  padding: 0px 16px;
  border-radius: 15px;
}
.containerbottom {
  padding: 10px 16px;
  margin-top: 40px;
  border-radius: 15px;
}

span.psw {
  float: left;
  padding-top: 10px;
  color: #222;
  margin-bottom: 10px;
}


span.psw a {
  color: #061ac8;
}

/* hogy "text" módban is ugyanúgy nézzen ki */
input[type=email], input[type=password], input[type=text] {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  box-sizing: border-box;
  border-radius: 8px;
}

/* szem ikon elhelyezése */
.password-wrap {
  position: relative;
}


.toggle-password svg { fill: #222; display: none; }
.toggle-password .icon-eye { display: inline; } /* alap: mutatás ikon */
.password-wrap.is-visible .icon-eye { display: none; }
.password-wrap.is-visible .icon-eye-off { display: inline; }

.password-wrap { position: relative; }

.password-wrap input {
  padding-right: 52px; /* legyen hely a szemnek */
}

/* felülírjuk a globális button stílust CSAK a szem gombra */
.toggle-password{
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);

  width: 40px;         /* <-- ez a kulcs (ne legyen 100%) */
  height: 40px;
  margin: 0;           /* <-- ne legyen 8px 0 */
  padding: 0;          /* <-- ne legyen 14px 20px */
  border: 0;
  background: transparent;
  cursor: pointer;

  display: flex;
  align-items: center;
  justify-content: center;

  opacity: 0.75;
}

.toggle-password:hover { opacity: 1; }



/* Change styles for span and cancel button on extra small screens */
@media screen and (max-width: 300px) {
  span.psw {
     display: block;
     float: none;
  }
  .cancelbtn {
     width: 100%;
  }
}
</style>
</head>
<body>


<form id="loginForm" method="post">


  <div class="container">

    <h1 style="margin-bottom: 50px;"><span style="color: #D96C06;">Mesztor</span> admin</h1>
    <label for="uname"><b>Felhasználónév</b></label>
    <input type="email" id="email" placeholder="Email címed" name="uname" required>

    <label for="psw"><b>Jelszó</b></label>

    <div class="password-wrap">
      <input type="password" id="password" placeholder="Jelszó" name="psw" required autocomplete="current-password">

      <button type="button" id="togglePassword" class="toggle-password"
              aria-label="Jelszó megjelenítése" aria-pressed="false" title="Jelszó megjelenítése">
        <!-- eye -->
        <svg class="icon-eye" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
          <path d="M12 5c5.5 0 9.5 5.2 9.5 7s-4 7-9.5 7S2.5 14.8 2.5 12 6.5 5 12 5zm0 2C7.8 7 4.6 11.1 4.6 12S7.8 17 12 17s7.4-4.1 7.4-5S16.2 7 12 7zm0 2.5A2.5 2.5 0 1 1 9.5 12 2.5 2.5 0 0 1 12 9.5z"></path>
        </svg>
        <!-- eye-off -->
        <svg class="icon-eye-off" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
          <path d="M2.3 3.7 3.7 2.3 21.7 20.3 20.3 21.7l-3.1-3.1c-1.5.9-3.3 1.4-5.2 1.4C6.5 20 2.5 14.8 2.5 13c0-1 1.4-3.1 3.6-4.8L2.3 3.7zm8.2 8.2a2.5 2.5 0 0 0 3.6 3.6l-3.6-3.6zM12 6c5.5 0 9.5 5.2 9.5 7 0 .8-.9 2.4-2.4 3.9l-1.4-1.4c1.1-1.1 1.8-2.2 1.8-2.5 0-.9-3.2-5-7.4-5-1.2 0-2.3.3-3.2.8L7.5 7.4C8.8 6.5 10.3 6 12 6z"></path>
        </svg>
      </button>
    </div>


    <div style="display: grid; grid-template-rows: 1fr 1fr; margin-top: 20px;">
      <div>
        <button type="submit">Bejelentkezés →</button>
      </div>
      <div id="authMsg" style="margin-top:10px;font-size:14px;"></div>
      <div>
        <span class="psw">Elfelejtettem a <a href="#" id="resetLink">jelszavam</a></span>
      </div>
      
    

    </div>
    
  </div>

</form>

<script type="module">
  import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, setPersistence, browserLocalPersistence, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAZUGCJkn9L4xH_M8L0fZYTUresZ9qYPqo",
    authDomain: "flymeto-696d0.firebaseapp.com",
    databaseURL: "https://flymeto-696d0-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "flymeto-696d0",
    storageBucket: "flymeto-696d0.firebasestorage.app",
    messagingSenderId: "651204605205",
    appId: "1:651204605205:web:d5dfbf3698be7ac6ee251c",
    measurementId: "G-4L7YN2X9YL"
  };

  const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // "Emlékezzen rám" (alapból local)
  try { await setPersistence(auth, browserLocalPersistence); } catch {}

  const form = document.getElementById("loginForm");
  const emailEl = document.getElementById("email");
  const passEl  = document.getElementById("password");
  const msgEl   = document.getElementById("authMsg");
  const resetLink = document.getElementById("resetLink");

    const toggleBtn = document.getElementById("togglePassword");
  const passWrap = document.querySelector(".password-wrap");

  toggleBtn?.addEventListener("click", () => {
    const isHidden = passEl.type === "password";
    passEl.type = isHidden ? "text" : "password";

    // UI/ARIA
    passWrap?.classList.toggle("is-visible", isHidden);
    toggleBtn.setAttribute("aria-pressed", String(isHidden));
    toggleBtn.setAttribute("aria-label", isHidden ? "Jelszó elrejtése" : "Jelszó megjelenítése");
    toggleBtn.title = isHidden ? "Jelszó elrejtése" : "Jelszó megjelenítése";
  });


  const params = new URLSearchParams(location.search);
  const next = params.get("next") || "./index.html";

  function setMsg(text, ok=false){
    if(!msgEl) return;
    msgEl.textContent = text || "";
    msgEl.style.color = ok ? "#0f7a2a" : "#b00020";
  }

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    setMsg("");

    const email = (emailEl?.value || "").trim();
    const password = passEl?.value || "";

    if(!email || !password){
      setMsg("Add meg az email címet és a jelszót.");
      return;
    }

    try{
      await signInWithEmailAndPassword(auth, email, password);
      setMsg("Sikeres bejelentkezés ✅", true);
      location.replace(next);
    }catch(err){
      console.warn("[login] hiba:", err);
      const code = err?.code || "";
      if(code === "auth/unauthorized-domain"){
        setMsg("Hibás domain beállítás (auth/unauthorized-domain). Add hozzá a Netlify domaint a Firebase Console → Authentication → Settings → Authorized domains listához.");
      }else if(code === "auth/invalid-login-credentials" || code === "auth/wrong-password" || code === "auth/user-not-found"){
        setMsg("Hibás email vagy jelszó.");
      }else{
        setMsg("Nem sikerült bejelentkezni. (" + (code || "ismeretlen hiba") + ")");
      }
    }
  });

  resetLink?.addEventListener("click", async (e) => {
    e.preventDefault();
    setMsg("");
    const email = (emailEl?.value || "").trim();
    if(!email){
      setMsg("Írd be az email címedet, és utána kattints a jelszó-visszaállításhoz.");
      return;
    }
    try{
      await sendPasswordResetEmail(auth, email);
      setMsg("Jelszó-visszaállító email elküldve ✅", true);
    }catch(err){
      console.warn("[reset] hiba:", err);
      setMsg("Nem sikerült jelszó-visszaállítót küldeni. (" + (err?.code || "ismeretlen hiba") + ")");
    }
  });
</script>
</body>
</html>