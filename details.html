<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <title>Termék részletei – Mesz-Tor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Mesz-Tor kaputechnika – termékválaszték részletes adatlap." />

  <style>
    :root {
      --bg-body: #020617;
      --bg-surface: #020617;
      --bg-card: #020617;
      --border-subtle: rgba(148, 163, 184, 0.3);
      --color-text: #222222;
      --color-muted: #94a3b8;
      --color-accent: #f97316;
      --color-link: #38bdf8;
      --shadow-lg: 0 25px 50px rgba(15, 23, 42, 0.75);
      --radius-xl: 1.25rem;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #eeeeee;
      color: var(--color-text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    a {
      color: var(--color-link);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .container {
      width: min(1100px, 100% - 2rem);
      margin-inline: auto;
    }

    /* Fejléc / vissza link */
    .detail-header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(16px);
      background: #fff;
    }

    .btn-primary {
      border-radius: 10px;
      border: none;
      cursor: pointer;
      padding: 0.85rem 1.6rem;
      font-weight: 600;
      font-size: 0.95rem;
      background: #222222;
      color: #ffffff;
    }

    .detail-header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.8rem 0;
      gap: 1rem;
    }

    .brand-img {
      height: 56px;
      width: 80px;
    }

    .brand {
      display: flex;
      align-items: center;
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--color-muted);
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      font-size: 0.9rem;
      padding: 0.35rem 0.1rem;
      border-radius: 999px;
      color: var(--color-muted);
    }

    .back-link span.ico {
      display: inline-flex;
      width: 1.35rem;
      height: 1.35rem;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.8rem;
    }

    main {
      flex: 1;
      padding: 1.5rem 0 2.5rem;
    }

    /* Termék kártya */
    .product-detail-card {
      background: #fff;
      border-radius: var(--radius-xl);
      padding: 1.5rem;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 4fr);
      gap: 1.75rem;
      align-items: stretch;
    }

    @media (max-width: 800px) {
      .product-detail-card {
        grid-template-columns: minmax(0, 1fr);
        padding: 1.1rem;
      }
    }

    .product-detail-image-wrap {
      position: relative;
      border-radius: 1rem;
      overflow: hidden;
      background: #fff;
      min-height: 220px;
      display: flex;
      align-items: stretch;
      justify-content: stretch;
    }

    .product-detail-image-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      filter: saturate(1.1);
    }

    .no-image {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.88rem;
      color: var(--color-muted);
    }

    .product-detail-body {
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
    }

    .product-detail-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.78rem;
      padding: 0.18rem 0.7rem;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.12);
      color: #7dd3fc;
      border: 1px solid rgba(56, 189, 248, 0.4);
      width: fit-content;
    }

    .product-detail-tag .dot {
      width: 0.35rem;
      height: 0.35rem;
      border-radius: 999px;
      background: #38bdf8;
      box-shadow: 0 0 0 4px rgba(56, 189, 248, 0.25);
    }

    .product-detail-title {
      font-size: clamp(1.5rem, 2.2vw + 0.3rem, 2.1rem);
      letter-spacing: -0.03em;
    }

    .product-detail-short {
      font-size: 0.95rem;
      color: var(--color-muted);
    }

    .product-detail-long {
      font-size: 0.94rem;
      line-height: 1.6;
      color: #222222;
      padding: 0.85rem 0.9rem;
      border-radius: 0.9rem;
      background: radial-gradient(circle at top, rgba(148, 163, 184, 0.09), transparent 60%);
      border: 1px solid rgba(51, 65, 85, 0.75);
      max-height: 420px;
      overflow: auto;
    }

    .product-detail-long p {
      margin: 0 0 0.7rem;
    }

    .product-detail-long p:last-child {
      margin-bottom: 0;
    }

    .status {
      margin-top: 0.9rem;
      font-size: 0.86rem;
      color: var(--color-muted);
    }

    .status.error {
      color: #f97373;
    }

    .muted {
      color: var(--color-muted);
    }

    footer {
      padding: 0.8rem 0 1.3rem;
      font-size: 0.8rem;
      background-color: #fff;
      color: var(--color-muted);
    }

    footer .footer-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }

    @media (max-width: 640px) {
      footer .footer-inner {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <header class="detail-header">
    <div class="container detail-header-inner">
      <div class="brand">
        <img src="mesztor-effect.png" class="brand-img" alt="">
        <span style="display: flex; align-items: center; margin-left: 20px;">Mesz-Tor Kft. – Kaputechnika</span>
      </div>
      <a href="index.html#products" class="back-link">
        <span class="ico">←</span>
        <span>Vissza a termékválasztékhoz</span>
      </a>
    </div>
  </header>

  <main>
    <section id="product-detail">
      <div class="container">
        <div id="product-detail-card" class="product-detail-card">
          <div id="product-detail-image-wrap" class="product-detail-image-wrap">
            <div class="no-image" id="product-no-image">Termékfotó betöltése...</div>
            <img id="product-detail-image" src="" alt="" loading="lazy" style="display:none;" />
          </div>

          <div class="product-detail-body">
            <div class="product-detail-tag">
              <span class="dot"></span>
              <span>Termék részletes adatlap</span>
            </div>

            <h1 id="product-detail-title" class="product-detail-title">
              Termék betöltése...
            </h1>

            <p id="product-detail-short" class="product-detail-short"></p>

            <div id="product-detail-long" class="product-detail-long">
              <p class="muted">A részletes leírás betöltésre kerül...</p>
            </div>
            <button
              class="btn-primary"
              style="width:100%;justify-content:center;box-shadow:none;"
              data-section="contact"
              data-field="contact_mail"
              onclick="window.location.href='mailto:mesztorkaputechnika1@gmail.com';"
            >
              Ajánlatkérés e-mailben
            </button>
          </div>
        </div>

        <p id="product-detail-status" class="status"></p>
      </div>
    </section>
  </main>

  <footer>
    <div class="container footer-inner">
      <span>© Mesz-Tor Kft. – Kaputechnika</span>
      <span class="muted">Ha kérdése van, kérjen ajánlatot a főoldalon.</span>
    </div>
  </footer>

  <!-- Firebase + betöltés -->
  <script type="module">
    import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAZUGCJkn9L4xH_M8L0fZYTUresZ9qYPqo",
      authDomain: "flymeto-696d0.firebaseapp.com",
      databaseURL: "https://flymeto-696d0-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "flymeto-696d0",
      storageBucket: "flymeto-696d0.firebasestorage.app",
      messagingSenderId: "651204605205",
      appId: "1:651204605205:web:d5dfbf3698be7ac6ee251c",
      measurementId: "G-4L7YN2X9YL"
    };

    let app, db, firebaseEnabled = false;

    try {
      app = getApps().length ? getApp() : initializeApp(firebaseConfig);
      db = getDatabase(app);
      firebaseEnabled = true;
    } catch (err) {
      console.warn("[details] Firebase init hiba:", err);
      firebaseEnabled = false;
    }

    const titleEl    = document.getElementById("product-detail-title");
    const shortEl    = document.getElementById("product-detail-short");
    const longEl     = document.getElementById("product-detail-long");
    const statusEl   = document.getElementById("product-detail-status");
    const imgWrapEl  = document.getElementById("product-detail-image-wrap");
    const imgEl      = document.getElementById("product-detail-image");
    const noImgEl    = document.getElementById("product-no-image");

    async function loadProduct() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      if (!id) {
        statusEl.textContent = "Hiányzik a termék azonosító az URL-ből.";
        statusEl.classList.add("error");
        if (noImgEl) noImgEl.textContent = "Nincs termék azonosító.";
        return;
      }

      statusEl.textContent = "Termék betöltése...";
      statusEl.classList.remove("error");

      if (!firebaseEnabled || !db) {
        statusEl.textContent = "A termék nem tölthető be (Firebase demó / offline mód).";
        statusEl.classList.add("error");
        if (noImgEl) noImgEl.textContent = "Nem érhető el a termékadat.";
        return;
      }

      try {
        const snap = await get(ref(db, "products/" + id));
        if (!snap.exists()) {
          statusEl.textContent = "A keresett termék nem található.";
          statusEl.classList.add("error");
          if (noImgEl) noImgEl.textContent = "Nincs ilyen termék.";
          titleEl.textContent = "Ismeretlen termék";
          return;
        }

        const data = snap.val() || {};
        const name = data.name || "Termék";
        const short = data.shortDescription || data.tagline || "";
        const long = data.longDescription || data.description || "";
        const imgSrc = data.imageUrl || data.imageDataUrl || "";

        document.title = name + " – Mesz-Tor termék";
        titleEl.textContent = name;
        shortEl.textContent = short;

        if (long) {
          const paragraphs = long.split(/\n\s*\n/);
          longEl.innerHTML = paragraphs
            .map(p => `<p>${p.replace(/\n/g, "<br>")}</p>`)
            .join("");
        } else {
          longEl.innerHTML = '<p class="muted">Ehhez a termékhez még nincs hosszabb leírás megadva.</p>';
        }

        if (imgSrc) {
          if (noImgEl) noImgEl.style.display = "none";
          imgEl.src = imgSrc;
          imgEl.alt = name + " – termék fotó";
          imgEl.style.display = "block";
        } else {
          if (noImgEl) {
            noImgEl.textContent = "Ehhez a termékhez még nincs kép feltöltve.";
          }
        }

        statusEl.textContent = "";
      } catch (err) {
        console.warn("[details] Termék betöltési hiba:", err);
        statusEl.textContent = "Hiba történt a termék betöltésekor.";
        statusEl.classList.add("error");
        if (noImgEl) noImgEl.textContent = "Betöltési hiba.";
      }
    }

    loadProduct();
  </script>
</body>
</html>
